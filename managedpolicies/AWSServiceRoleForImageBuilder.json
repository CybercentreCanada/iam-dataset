{"name": "AWSServiceRoleForImageBuilder", "deprecated": false, "createdate": "2021-08-11T18:07:10Z", "updatedate": "2021-08-11T18:07:10+00:00", "version": "v13", "malformed": false, "unknown_actions": [], "access_levels": ["List", "Read", "Tagging", "Write", "Permissions management"], "privesc": true, "resource_exposure": true, "credentials_exposure": true, "undocumented_actions": false, "document": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["ec2:RunInstances"], "Resource": ["arn:aws:ec2:*::image/*", "arn:aws:ec2:*::snapshot/*", "arn:aws:ec2:*:*:subnet/*", "arn:aws:ec2:*:*:network-interface/*", "arn:aws:ec2:*:*:security-group/*", "arn:aws:ec2:*:*:key-pair/*"]}, {"Effect": "Allow", "Action": ["ec2:RunInstances"], "Resource": ["arn:aws:ec2:*:*:volume/*", "arn:aws:ec2:*:*:instance/*"], "Condition": {"StringEquals": {"aws:RequestTag/CreatedBy": "EC2 Image Builder"}}}, {"Effect": "Allow", "Action": ["iam:PassRole"], "Resource": "*", "Condition": {"StringEquals": {"iam:PassedToService": ["ec2.amazonaws.com", "ec2.amazonaws.com.cn"]}}}, {"Effect": "Allow", "Action": ["ec2:StopInstances", "ec2:TerminateInstances"], "Resource": "*", "Condition": {"ForAnyValue:StringEquals": {"ec2:ResourceTag/CreatedBy": "EC2 Image Builder"}}}, {"Effect": "Allow", "Action": ["ec2:CopyImage", "ec2:CreateImage", "ec2:CreateLaunchTemplate", "ec2:DeregisterImage", "ec2:DescribeImages", "ec2:DescribeInstanceAttribute", "ec2:DescribeInstanceStatus", "ec2:DescribeInstances", "ec2:DescribeInstanceTypeOfferings", "ec2:DescribeInstanceTypes", "ec2:DescribeSubnets", "ec2:DescribeTags", "ec2:ModifyImageAttribute"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ec2:ModifySnapshotAttribute"], "Resource": "arn:aws:ec2:*::snapshot/*", "Condition": {"ForAnyValue:StringEquals": {"ec2:ResourceTag/CreatedBy": "EC2 Image Builder"}}}, {"Effect": "Allow", "Action": ["ec2:CreateTags"], "Resource": "arn:aws:ec2:*::image/*"}, {"Effect": "Allow", "Action": ["ec2:CreateTags"], "Resource": "*", "Condition": {"ForAnyValue:StringEquals": {"aws:RequestTag/CreatedBy": "EC2 Image Builder"}}}, {"Effect": "Allow", "Action": ["license-manager:UpdateLicenseSpecificationsForResource"], "Resource": "*"}, {"Effect": "Allow", "Action": ["sns:Publish"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ssm:ListCommands", "ssm:ListCommandInvocations", "ssm:AddTagsToResource", "ssm:DescribeInstanceInformation", "ssm:GetAutomationExecution", "ssm:StopAutomationExecution", "ssm:ListInventoryEntries", "ssm:SendAutomationSignal", "ssm:DescribeInstanceAssociationsStatus", "ssm:DescribeAssociationExecutions"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ssm:SendCommand"], "Resource": ["arn:aws:ssm:*:*:document/AWS-RunPowerShellScript", "arn:aws:ssm:*:*:document/AWS-RunShellScript", "arn:aws:ssm:*:*:document/AWSEC2-RunSysprep", "arn:aws:s3:::*"]}, {"Effect": "Allow", "Action": ["ssm:SendCommand"], "Resource": ["arn:aws:ec2:*:*:instance/*"], "Condition": {"ForAnyValue:StringEquals": {"ssm:resourceTag/CreatedBy": ["EC2 Image Builder"]}}}, {"Effect": "Allow", "Action": ["ssm:StartAutomationExecution"], "Resource": "arn:aws:ssm:*:*:automation-definition/ImageBuilder*"}, {"Effect": "Allow", "Action": ["ssm:CreateAssociation", "ssm:DeleteAssociation"], "Resource": ["arn:aws:ssm:*:*:document/AWS-GatherSoftwareInventory", "arn:aws:ssm:*:*:association/*", "arn:aws:ec2:*:*:instance/*"]}, {"Effect": "Allow", "Action": ["kms:Encrypt", "kms:Decrypt", "kms:ReEncryptFrom", "kms:ReEncryptTo", "kms:GenerateDataKeyWithoutPlaintext", "kms:DescribeKey"], "Resource": "*", "Condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}}, {"Effect": "Allow", "Action": ["kms:CreateGrant"], "Resource": "*", "Condition": {"Bool": {"kms:GrantIsForAWSResource": true}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}}, {"Effect": "Allow", "Action": ["sts:AssumeRole"], "Resource": "arn:aws:iam::*:role/EC2ImageBuilderDistributionCrossAccountRole"}, {"Effect": "Allow", "Action": ["logs:CreateLogStream", "logs:CreateLogGroup", "logs:PutLogEvents"], "Resource": "arn:aws:logs:*:*:log-group:/aws/imagebuilder/*"}, {"Effect": "Allow", "Action": ["ec2:CreateLaunchTemplateVersion", "ec2:DescribeLaunchTemplates", "ec2:ModifyLaunchTemplate"], "Resource": "*"}, {"Effect": "Allow", "Action": ["iam:CreateServiceLinkedRole"], "Resource": "*", "Condition": {"StringEquals": {"iam:AWSServiceName": "ssm.amazonaws.com"}}}]}, "effective_actions": [{"action": "ec2:RunInstances", "effective_action": "ec2:RunInstances", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:RunInstances", "effective_action": "ec2:RunInstances", "access_level": "Write", "condition": {"StringEquals": {"aws:RequestTag/CreatedBy": "EC2 Image Builder"}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "iam:PassRole", "effective_action": "iam:PassRole", "access_level": "Write", "condition": {"StringEquals": {"iam:PassedToService": ["ec2.amazonaws.com", "ec2.amazonaws.com.cn"]}}, "privesc": true, "resource_exposure": true, "credentials_exposure": false}, {"action": "ec2:StopInstances", "effective_action": "ec2:StopInstances", "access_level": "Write", "condition": {"ForAnyValue:StringEquals": {"ec2:ResourceTag/CreatedBy": "EC2 Image Builder"}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:TerminateInstances", "effective_action": "ec2:TerminateInstances", "access_level": "Write", "condition": {"ForAnyValue:StringEquals": {"ec2:ResourceTag/CreatedBy": "EC2 Image Builder"}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:CopyImage", "effective_action": "ec2:CopyImage", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:CreateImage", "effective_action": "ec2:CreateImage", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:CreateLaunchTemplate", "effective_action": "ec2:CreateLaunchTemplate", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DeregisterImage", "effective_action": "ec2:DeregisterImage", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeImages", "effective_action": "ec2:DescribeImages", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeInstanceAttribute", "effective_action": "ec2:DescribeInstanceAttribute", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeInstanceStatus", "effective_action": "ec2:DescribeInstanceStatus", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeInstances", "effective_action": "ec2:DescribeInstances", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeInstanceTypeOfferings", "effective_action": "ec2:DescribeInstanceTypeOfferings", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeInstanceTypes", "effective_action": "ec2:DescribeInstanceTypes", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeSubnets", "effective_action": "ec2:DescribeSubnets", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeTags", "effective_action": "ec2:DescribeTags", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:ModifyImageAttribute", "effective_action": "ec2:ModifyImageAttribute", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:ModifySnapshotAttribute", "effective_action": "ec2:ModifySnapshotAttribute", "access_level": "Permissions management", "condition": {"ForAnyValue:StringEquals": {"ec2:ResourceTag/CreatedBy": "EC2 Image Builder"}}, "privesc": false, "resource_exposure": true, "credentials_exposure": false}, {"action": "ec2:CreateTags", "effective_action": "ec2:CreateTags", "access_level": "Tagging", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:CreateTags", "effective_action": "ec2:CreateTags", "access_level": "Tagging", "condition": {"ForAnyValue:StringEquals": {"aws:RequestTag/CreatedBy": "EC2 Image Builder"}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "license-manager:UpdateLicenseSpecificationsForResource", "effective_action": "license-manager:UpdateLicenseSpecificationsForResource", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "sns:Publish", "effective_action": "sns:Publish", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:ListCommands", "effective_action": "ssm:ListCommands", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:ListCommandInvocations", "effective_action": "ssm:ListCommandInvocations", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:AddTagsToResource", "effective_action": "ssm:AddTagsToResource", "access_level": "Tagging", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:DescribeInstanceInformation", "effective_action": "ssm:DescribeInstanceInformation", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:GetAutomationExecution", "effective_action": "ssm:GetAutomationExecution", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:StopAutomationExecution", "effective_action": "ssm:StopAutomationExecution", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:ListInventoryEntries", "effective_action": "ssm:ListInventoryEntries", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:SendAutomationSignal", "effective_action": "ssm:SendAutomationSignal", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:DescribeInstanceAssociationsStatus", "effective_action": "ssm:DescribeInstanceAssociationsStatus", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:DescribeAssociationExecutions", "effective_action": "ssm:DescribeAssociationExecutions", "access_level": "Read", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:SendCommand", "effective_action": "ssm:SendCommand", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:SendCommand", "effective_action": "ssm:SendCommand", "access_level": "Write", "condition": {"ForAnyValue:StringEquals": {"ssm:resourceTag/CreatedBy": ["EC2 Image Builder"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:StartAutomationExecution", "effective_action": "ssm:StartAutomationExecution", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:CreateAssociation", "effective_action": "ssm:CreateAssociation", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ssm:DeleteAssociation", "effective_action": "ssm:DeleteAssociation", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:Encrypt", "effective_action": "kms:Encrypt", "access_level": "Write", "condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:Decrypt", "effective_action": "kms:Decrypt", "access_level": "Write", "condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:ReEncryptFrom", "effective_action": "kms:ReEncryptFrom", "access_level": "Write", "condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:ReEncryptTo", "effective_action": "kms:ReEncryptTo", "access_level": "Write", "condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:GenerateDataKeyWithoutPlaintext", "effective_action": "kms:GenerateDataKeyWithoutPlaintext", "access_level": "Write", "condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:DescribeKey", "effective_action": "kms:DescribeKey", "access_level": "Read", "condition": {"ForAllValues:StringEquals": {"kms:EncryptionContextKeys": ["aws:ebs:id"]}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "kms:CreateGrant", "effective_action": "kms:CreateGrant", "access_level": "Permissions management", "condition": {"Bool": {"kms:GrantIsForAWSResource": true}, "StringLike": {"kms:ViaService": ["ec2.*.amazonaws.com"]}}, "privesc": false, "resource_exposure": true, "credentials_exposure": false}, {"action": "sts:AssumeRole", "effective_action": "sts:AssumeRole", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": true}, {"action": "logs:CreateLogStream", "effective_action": "logs:CreateLogStream", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "logs:CreateLogGroup", "effective_action": "logs:CreateLogGroup", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "logs:PutLogEvents", "effective_action": "logs:PutLogEvents", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:CreateLaunchTemplateVersion", "effective_action": "ec2:CreateLaunchTemplateVersion", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:DescribeLaunchTemplates", "effective_action": "ec2:DescribeLaunchTemplates", "access_level": "List", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "ec2:ModifyLaunchTemplate", "effective_action": "ec2:ModifyLaunchTemplate", "access_level": "Write", "condition": null, "privesc": false, "resource_exposure": false, "credentials_exposure": false}, {"action": "iam:CreateServiceLinkedRole", "effective_action": "iam:CreateServiceLinkedRole", "access_level": "Write", "condition": {"StringEquals": {"iam:AWSServiceName": "ssm.amazonaws.com"}}, "privesc": true, "resource_exposure": true, "credentials_exposure": false}]}