{"name": "AWSServiceRoleForSMS", "deprecated": false, "createdate": "2020-10-15T17:28:13Z", "updatedate": "2020-10-15T17:28:13+00:00", "version": "v10", "malformed": false, "unknown_actions": [], "access_levels": ["List", "Read", "Tagging", "Write", "Permissions management"], "privesc": true, "document": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["cloudformation:CreateChangeSet", "cloudformation:CreateStack"], "Resource": "arn:aws:cloudformation:*:*:stack/sms-app-*/*", "Condition": {"Null": {"cloudformation:ResourceTypes": "false"}, "ForAllValues:StringEquals": {"cloudformation:ResourceTypes": ["AWS::EC2::Instance", "AWS::ApplicationInsights::Application", "AWS::ResourceGroups::Group"]}}}, {"Effect": "Allow", "Action": ["cloudformation:DeleteStack", "cloudformation:ExecuteChangeSet", "cloudformation:DeleteChangeSet", "cloudformation:DescribeChangeSet", "cloudformation:DescribeStacks", "cloudformation:DescribeStackEvents", "cloudformation:DescribeStackResource", "cloudformation:DescribeStackResources", "cloudformation:GetTemplate"], "Resource": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}, {"Effect": "Allow", "Action": ["cloudformation:ValidateTemplate", "s3:ListAllMyBuckets"], "Resource": "*"}, {"Effect": "Allow", "Action": ["s3:CreateBucket", "s3:DeleteBucket", "s3:DeleteObject", "s3:GetBucketAcl", "s3:GetBucketLocation", "s3:GetObject", "s3:ListBucket", "s3:PutObject", "s3:PutObjectAcl", "s3:PutLifecycleConfiguration"], "Resource": "arn:aws:s3:::sms-app-*"}, {"Effect": "Allow", "Action": ["sms:CreateReplicationJob", "sms:DeleteReplicationJob", "sms:GetReplicationJobs", "sms:GetReplicationRuns", "sms:GetServers", "sms:ImportServerCatalog", "sms:StartOnDemandReplicationRun", "sms:UpdateReplicationJob"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ssm:SendCommand"], "Resource": ["arn:aws:ssm:*::document/AWS-RunRemoteScript", "arn:aws:s3:::sms-app-*"]}, {"Effect": "Allow", "Action": ["ssm:SendCommand"], "Resource": "arn:aws:ec2:*:*:instance/*", "Condition": {"StringEquals": {"ssm:resourceTag/UseForSMSApplicationValidation": ["true"]}}}, {"Effect": "Allow", "Action": ["ssm:CancelCommand", "ssm:GetCommandInvocation"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ec2:CreateTags"], "Resource": "arn:aws:ec2:*:*:snapshot/*", "Condition": {"StringEquals": {"ec2:CreateAction": "CopySnapshot"}}}, {"Effect": "Allow", "Action": ["ec2:CopySnapshot"], "Resource": "arn:aws:ec2:*:*:snapshot/*", "Condition": {"StringLike": {"aws:RequestTag/SMSJobId": ["sms-*"]}}}, {"Effect": "Allow", "Action": ["ec2:ModifySnapshotAttribute", "ec2:DeleteSnapshot"], "Resource": "arn:aws:ec2:*:*:snapshot/*", "Condition": {"StringLike": {"ec2:ResourceTag/SMSJobId": ["sms-*"]}}}, {"Effect": "Allow", "Action": ["ec2:CopyImage", "ec2:DescribeImages", "ec2:DescribeInstances", "ec2:DescribeSnapshots", "ec2:DescribeSnapshotAttribute", "ec2:DeregisterImage", "ec2:ImportImage", "ec2:DescribeImportImageTasks", "ec2:GetEbsEncryptionByDefault"], "Resource": "*"}, {"Effect": "Allow", "Action": ["iam:GetRole", "iam:GetInstanceProfile"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ec2:DisassociateIamInstanceProfile", "ec2:AssociateIamInstanceProfile", "ec2:ReplaceIamInstanceProfileAssociation"], "Resource": "arn:aws:ec2:*:*:instance/*", "Condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}}, {"Effect": "Allow", "Action": ["iam:PassRole"], "Resource": "*", "Condition": {"StringEquals": {"iam:PassedToService": "ec2.amazonaws.com"}}}, {"Effect": "Allow", "Action": ["iam:PassRole"], "Resource": "*", "Condition": {"StringEqualsIfExists": {"iam:PassedToService": "cloudformation.amazonaws.com"}, "StringLike": {"iam:AssociatedResourceArn": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}}, {"Effect": "Allow", "Action": ["ec2:RunInstances"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ec2:CreateTags", "ec2:DeleteTags"], "Resource": "arn:aws:ec2:*:*:instance/*"}, {"Effect": "Allow", "Action": ["ec2:ModifyInstanceAttribute", "ec2:StopInstances", "ec2:StartInstances", "ec2:TerminateInstances"], "Resource": "*", "Condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}}, {"Effect": "Allow", "Action": ["applicationinsights:Describe*", "applicationinsights:List*", "cloudformation:ListStackResources"], "Resource": "*"}, {"Effect": "Allow", "Action": ["applicationinsights:CreateApplication", "applicationinsights:CreateComponent", "applicationinsights:UpdateApplication", "applicationinsights:DeleteApplication", "applicationinsights:UpdateComponentConfiguration", "applicationinsights:DeleteComponent"], "Resource": "arn:aws:applicationinsights:*:*:application/resource-group/sms-app-*"}, {"Effect": "Allow", "Action": ["resource-groups:CreateGroup", "resource-groups:GetGroup", "resource-groups:UpdateGroup", "resource-groups:DeleteGroup"], "Resource": "arn:aws:resource-groups:*:*:group/sms-app-*", "Condition": {"StringLike": {"aws:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}}, {"Effect": "Allow", "Action": ["iam:CreateServiceLinkedRole"], "Resource": ["arn:aws:iam::*:role/aws-service-role/application-insights.amazonaws.com/AWSServiceRoleForApplicationInsights"], "Condition": {"StringEquals": {"iam:AWSServiceName": "application-insights.amazonaws.com"}}}]}, "effective_actions": [{"action": "cloudformation:CreateChangeSet", "effective_action": "cloudformation:CreateChangeSet", "access_level": "Write", "condition": {"Null": {"cloudformation:ResourceTypes": "false"}, "ForAllValues:StringEquals": {"cloudformation:ResourceTypes": ["AWS::EC2::Instance", "AWS::ApplicationInsights::Application", "AWS::ResourceGroups::Group"]}}, "privesc": false}, {"action": "cloudformation:CreateStack", "effective_action": "cloudformation:CreateStack", "access_level": "Write", "condition": {"Null": {"cloudformation:ResourceTypes": "false"}, "ForAllValues:StringEquals": {"cloudformation:ResourceTypes": ["AWS::EC2::Instance", "AWS::ApplicationInsights::Application", "AWS::ResourceGroups::Group"]}}, "privesc": false}, {"action": "cloudformation:DeleteStack", "effective_action": "cloudformation:DeleteStack", "access_level": "Write", "condition": null, "privesc": false}, {"action": "cloudformation:ExecuteChangeSet", "effective_action": "cloudformation:ExecuteChangeSet", "access_level": "Write", "condition": null, "privesc": false}, {"action": "cloudformation:DeleteChangeSet", "effective_action": "cloudformation:DeleteChangeSet", "access_level": "Write", "condition": null, "privesc": false}, {"action": "cloudformation:DescribeChangeSet", "effective_action": "cloudformation:DescribeChangeSet", "access_level": "Read", "condition": null, "privesc": false}, {"action": "cloudformation:DescribeStacks", "effective_action": "cloudformation:DescribeStacks", "access_level": "List", "condition": null, "privesc": false}, {"action": "cloudformation:DescribeStackEvents", "effective_action": "cloudformation:DescribeStackEvents", "access_level": "Read", "condition": null, "privesc": false}, {"action": "cloudformation:DescribeStackResource", "effective_action": "cloudformation:DescribeStackResource", "access_level": "Read", "condition": null, "privesc": false}, {"action": "cloudformation:DescribeStackResources", "effective_action": "cloudformation:DescribeStackResources", "access_level": "Read", "condition": null, "privesc": false}, {"action": "cloudformation:GetTemplate", "effective_action": "cloudformation:GetTemplate", "access_level": "Read", "condition": null, "privesc": false}, {"action": "cloudformation:ValidateTemplate", "effective_action": "cloudformation:ValidateTemplate", "access_level": "Read", "condition": null, "privesc": false}, {"action": "s3:ListAllMyBuckets", "effective_action": "s3:ListAllMyBuckets", "access_level": "List", "condition": null, "privesc": false}, {"action": "s3:CreateBucket", "effective_action": "s3:CreateBucket", "access_level": "Write", "condition": null, "privesc": false}, {"action": "s3:DeleteBucket", "effective_action": "s3:DeleteBucket", "access_level": "Write", "condition": null, "privesc": false}, {"action": "s3:DeleteObject", "effective_action": "s3:DeleteObject", "access_level": "Write", "condition": null, "privesc": false}, {"action": "s3:GetBucketAcl", "effective_action": "s3:GetBucketAcl", "access_level": "Read", "condition": null, "privesc": false}, {"action": "s3:GetBucketLocation", "effective_action": "s3:GetBucketLocation", "access_level": "Read", "condition": null, "privesc": false}, {"action": "s3:GetObject", "effective_action": "s3:GetObject", "access_level": "Read", "condition": null, "privesc": false}, {"action": "s3:ListBucket", "effective_action": "s3:ListBucket", "access_level": "List", "condition": null, "privesc": false}, {"action": "s3:PutObject", "effective_action": "s3:PutObject", "access_level": "Write", "condition": null, "privesc": false}, {"action": "s3:PutObjectAcl", "effective_action": "s3:PutObjectAcl", "access_level": "Permissions management", "condition": null, "privesc": false}, {"action": "s3:PutLifecycleConfiguration", "effective_action": "s3:PutLifecycleConfiguration", "access_level": "Write", "condition": null, "privesc": false}, {"action": "sms:CreateReplicationJob", "effective_action": "sms:CreateReplicationJob", "access_level": "Write", "condition": null, "privesc": false}, {"action": "sms:DeleteReplicationJob", "effective_action": "sms:DeleteReplicationJob", "access_level": "Write", "condition": null, "privesc": false}, {"action": "sms:GetReplicationJobs", "effective_action": "sms:GetReplicationJobs", "access_level": "Read", "condition": null, "privesc": false}, {"action": "sms:GetReplicationRuns", "effective_action": "sms:GetReplicationRuns", "access_level": "Read", "condition": null, "privesc": false}, {"action": "sms:GetServers", "effective_action": "sms:GetServers", "access_level": "Read", "condition": null, "privesc": false}, {"action": "sms:ImportServerCatalog", "effective_action": "sms:ImportServerCatalog", "access_level": "Write", "condition": null, "privesc": false}, {"action": "sms:StartOnDemandReplicationRun", "effective_action": "sms:StartOnDemandReplicationRun", "access_level": "Write", "condition": null, "privesc": false}, {"action": "sms:UpdateReplicationJob", "effective_action": "sms:UpdateReplicationJob", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ssm:SendCommand", "effective_action": "ssm:SendCommand", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ssm:SendCommand", "effective_action": "ssm:SendCommand", "access_level": "Write", "condition": {"StringEquals": {"ssm:resourceTag/UseForSMSApplicationValidation": ["true"]}}, "privesc": false}, {"action": "ssm:CancelCommand", "effective_action": "ssm:CancelCommand", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ssm:GetCommandInvocation", "effective_action": "ssm:GetCommandInvocation", "access_level": "Read", "condition": null, "privesc": false}, {"action": "ec2:CreateTags", "effective_action": "ec2:CreateTags", "access_level": "Tagging", "condition": {"StringEquals": {"ec2:CreateAction": "CopySnapshot"}}, "privesc": false}, {"action": "ec2:CopySnapshot", "effective_action": "ec2:CopySnapshot", "access_level": "Write", "condition": {"StringLike": {"aws:RequestTag/SMSJobId": ["sms-*"]}}, "privesc": false}, {"action": "ec2:ModifySnapshotAttribute", "effective_action": "ec2:ModifySnapshotAttribute", "access_level": "Permissions management", "condition": {"StringLike": {"ec2:ResourceTag/SMSJobId": ["sms-*"]}}, "privesc": false}, {"action": "ec2:DeleteSnapshot", "effective_action": "ec2:DeleteSnapshot", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/SMSJobId": ["sms-*"]}}, "privesc": false}, {"action": "ec2:CopyImage", "effective_action": "ec2:CopyImage", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ec2:DescribeImages", "effective_action": "ec2:DescribeImages", "access_level": "List", "condition": null, "privesc": false}, {"action": "ec2:DescribeInstances", "effective_action": "ec2:DescribeInstances", "access_level": "List", "condition": null, "privesc": false}, {"action": "ec2:DescribeSnapshots", "effective_action": "ec2:DescribeSnapshots", "access_level": "List", "condition": null, "privesc": false}, {"action": "ec2:DescribeSnapshotAttribute", "effective_action": "ec2:DescribeSnapshotAttribute", "access_level": "List", "condition": null, "privesc": false}, {"action": "ec2:DeregisterImage", "effective_action": "ec2:DeregisterImage", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ec2:ImportImage", "effective_action": "ec2:ImportImage", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ec2:DescribeImportImageTasks", "effective_action": "ec2:DescribeImportImageTasks", "access_level": "List", "condition": null, "privesc": false}, {"action": "ec2:GetEbsEncryptionByDefault", "effective_action": "ec2:GetEbsEncryptionByDefault", "access_level": "Read", "condition": null, "privesc": false}, {"action": "iam:GetRole", "effective_action": "iam:GetRole", "access_level": "Read", "condition": null, "privesc": false}, {"action": "iam:GetInstanceProfile", "effective_action": "iam:GetInstanceProfile", "access_level": "Read", "condition": null, "privesc": false}, {"action": "ec2:DisassociateIamInstanceProfile", "effective_action": "ec2:DisassociateIamInstanceProfile", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "ec2:AssociateIamInstanceProfile", "effective_action": "ec2:AssociateIamInstanceProfile", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "ec2:ReplaceIamInstanceProfileAssociation", "effective_action": "ec2:ReplaceIamInstanceProfileAssociation", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "iam:PassRole", "effective_action": "iam:PassRole", "access_level": "Write", "condition": {"StringEquals": {"iam:PassedToService": "ec2.amazonaws.com"}}, "privesc": true}, {"action": "iam:PassRole", "effective_action": "iam:PassRole", "access_level": "Write", "condition": {"StringEqualsIfExists": {"iam:PassedToService": "cloudformation.amazonaws.com"}, "StringLike": {"iam:AssociatedResourceArn": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": true}, {"action": "ec2:RunInstances", "effective_action": "ec2:RunInstances", "access_level": "Write", "condition": null, "privesc": false}, {"action": "ec2:CreateTags", "effective_action": "ec2:CreateTags", "access_level": "Tagging", "condition": null, "privesc": false}, {"action": "ec2:DeleteTags", "effective_action": "ec2:DeleteTags", "access_level": "Tagging", "condition": null, "privesc": false}, {"action": "ec2:ModifyInstanceAttribute", "effective_action": "ec2:ModifyInstanceAttribute", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "ec2:StopInstances", "effective_action": "ec2:StopInstances", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "ec2:StartInstances", "effective_action": "ec2:StartInstances", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "ec2:TerminateInstances", "effective_action": "ec2:TerminateInstances", "access_level": "Write", "condition": {"StringLike": {"ec2:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeApplication", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeComponent", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeComponentConfiguration", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeComponentConfigurationRecommendation", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeLogPattern", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeObservation", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeProblem", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:Describe*", "effective_action": "applicationinsights:DescribeProblemObservations", "access_level": "Read", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListApplications", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListComponents", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListConfigurationHistory", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListLogPatternSets", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListLogPatterns", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListProblems", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:List*", "effective_action": "applicationinsights:ListTagsForResource", "access_level": "Read", "condition": null, "privesc": false}, {"action": "cloudformation:ListStackResources", "effective_action": "cloudformation:ListStackResources", "access_level": "List", "condition": null, "privesc": false}, {"action": "applicationinsights:CreateApplication", "effective_action": "applicationinsights:CreateApplication", "access_level": "Write", "condition": null, "privesc": false}, {"action": "applicationinsights:CreateComponent", "effective_action": "applicationinsights:CreateComponent", "access_level": "Write", "condition": null, "privesc": false}, {"action": "applicationinsights:UpdateApplication", "effective_action": "applicationinsights:UpdateApplication", "access_level": "Write", "condition": null, "privesc": false}, {"action": "applicationinsights:DeleteApplication", "effective_action": "applicationinsights:DeleteApplication", "access_level": "Write", "condition": null, "privesc": false}, {"action": "applicationinsights:UpdateComponentConfiguration", "effective_action": "applicationinsights:UpdateComponentConfiguration", "access_level": "Write", "condition": null, "privesc": false}, {"action": "applicationinsights:DeleteComponent", "effective_action": "applicationinsights:DeleteComponent", "access_level": "Write", "condition": null, "privesc": false}, {"action": "resource-groups:CreateGroup", "effective_action": "resource-groups:CreateGroup", "access_level": "Write", "condition": {"StringLike": {"aws:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "resource-groups:GetGroup", "effective_action": "resource-groups:GetGroup", "access_level": "Read", "condition": {"StringLike": {"aws:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "resource-groups:UpdateGroup", "effective_action": "resource-groups:UpdateGroup", "access_level": "Write", "condition": {"StringLike": {"aws:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "resource-groups:DeleteGroup", "effective_action": "resource-groups:DeleteGroup", "access_level": "Write", "condition": {"StringLike": {"aws:ResourceTag/aws:cloudformation:stack-id": "arn:aws:cloudformation:*:*:stack/sms-app-*/*"}}, "privesc": false}, {"action": "iam:CreateServiceLinkedRole", "effective_action": "iam:CreateServiceLinkedRole", "access_level": "Write", "condition": {"StringEquals": {"iam:AWSServiceName": "application-insights.amazonaws.com"}}, "privesc": false}]}