<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IAM Mapping Tool</title>
    <style>
        .column {
            float: left;
            width: 50%;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
  </head>
  <body>
    <div class="row">
        <div class="column">
            <div id="loadjsonarea">
                <button id="loadjsonbutton" onclick="loadJson()">Load JSON</button>
                <br />
            </div>
        
            <div id="methodmappingarea"></div>
            <br /><br /><button id="submitbutton" onclick="submitMapping()">Submit Mapping [`]</button>&nbsp;&nbsp;<button id="skipbutton" onclick="nextMethod()">Skip Mapping [\]</button>
        
            <br /><br /><br /><h4>Output</h4>
            <textarea id="output" cols="80" rows="20"></textarea>
        </div>
        <div class="column">
            <pre id="docs"></pre>
        </div>
    </div>



    <script>
        var map = {};
        var iamdef = {};
        var updated_map = {};
        var call = "";

        // https://sdk.amazonaws.com/builder/js/cache/2.839.0/metadata.json
        var sdkmetadata = JSON.parse(`{"version":"2.839.0","services":[{"name":"AWS.STS","identifier":"sts","browser":true,"versions":["2011-06-15"]},{"name":"AWS.CognitoIdentity","identifier":"cognitoidentity","browser":true,"versions":["2014-06-30"]},{"name":"AWS.ACM","identifier":"acm","browser":true,"versions":["2015-12-08"]},{"name":"AWS.APIGateway","identifier":"apigateway","browser":true,"versions":["2015-07-09"]},{"name":"AWS.ApplicationAutoScaling","identifier":"applicationautoscaling","browser":true,"versions":["2016-02-06"]},{"name":"AWS.AppStream","identifier":"appstream","browser":false,"versions":["2016-12-01"]},{"name":"AWS.AutoScaling","identifier":"autoscaling","browser":true,"versions":["2011-01-01"]},{"name":"AWS.Batch","identifier":"batch","browser":false,"versions":["2016-08-10"]},{"name":"AWS.Budgets","identifier":"budgets","browser":false,"versions":["2016-10-20"]},{"name":"AWS.CloudDirectory","identifier":"clouddirectory","browser":false,"versions":["2016-05-10","2017-01-11"]},{"name":"AWS.CloudFormation","identifier":"cloudformation","browser":true,"versions":["2010-05-15"]},{"name":"AWS.CloudFront","identifier":"cloudfront","browser":true,"versions":["2016-11-25","2017-03-25","2017-10-30","2018-06-18","2018-11-05","2019-03-26","2020-05-31"]},{"name":"AWS.CloudHSM","identifier":"cloudhsm","browser":true,"versions":["2014-05-30"]},{"name":"AWS.CloudSearch","identifier":"cloudsearch","browser":false,"versions":["2011-02-01","2013-01-01"]},{"name":"AWS.CloudSearchDomain","identifier":"cloudsearchdomain","browser":false,"versions":["2013-01-01"]},{"name":"AWS.CloudTrail","identifier":"cloudtrail","browser":true,"versions":["2013-11-01"]},{"name":"AWS.CloudWatch","identifier":"cloudwatch","browser":true,"versions":["2010-08-01"]},{"name":"AWS.CloudWatchEvents","identifier":"cloudwatchevents","browser":true,"versions":["2015-10-07"]},{"name":"AWS.CloudWatchLogs","identifier":"cloudwatchlogs","browser":true,"versions":["2014-03-28"]},{"name":"AWS.CodeBuild","identifier":"codebuild","browser":false,"versions":["2016-10-06"]},{"name":"AWS.CodeCommit","identifier":"codecommit","browser":true,"versions":["2015-04-13"]},{"name":"AWS.CodeDeploy","identifier":"codedeploy","browser":true,"versions":["2014-10-06"]},{"name":"AWS.CodePipeline","identifier":"codepipeline","browser":true,"versions":["2015-07-09"]},{"name":"AWS.CognitoIdentityServiceProvider","identifier":"cognitoidentityserviceprovider","browser":true,"versions":["2016-04-18"]},{"name":"AWS.CognitoSync","identifier":"cognitosync","browser":true,"versions":["2014-06-30"]},{"name":"AWS.ConfigService","identifier":"configservice","browser":true,"versions":["2014-11-12"]},{"name":"AWS.CUR","identifier":"cur","browser":false,"versions":["2017-01-06"]},{"name":"AWS.DataPipeline","identifier":"datapipeline","browser":false,"versions":["2012-10-29"]},{"name":"AWS.DeviceFarm","identifier":"devicefarm","browser":true,"versions":["2015-06-23"]},{"name":"AWS.DirectConnect","identifier":"directconnect","browser":true,"versions":["2012-10-25"]},{"name":"AWS.DirectoryService","identifier":"directoryservice","browser":false,"versions":["2015-04-16"]},{"name":"AWS.Discovery","identifier":"discovery","browser":false,"versions":["2015-11-01"]},{"name":"AWS.DMS","identifier":"dms","browser":false,"versions":["2016-01-01"]},{"name":"AWS.DynamoDB","identifier":"dynamodb","browser":true,"versions":["2011-12-05","2012-08-10"]},{"name":"AWS.DynamoDBStreams","identifier":"dynamodbstreams","browser":true,"versions":["2012-08-10"]},{"name":"AWS.EC2","identifier":"ec2","browser":true,"versions":["2016-11-15"]},{"name":"AWS.ECR","identifier":"ecr","browser":true,"versions":["2015-09-21"]},{"name":"AWS.ECS","identifier":"ecs","browser":true,"versions":["2014-11-13"]},{"name":"AWS.EFS","identifier":"efs","browser":false,"versions":["2015-02-01"]},{"name":"AWS.ElastiCache","identifier":"elasticache","browser":true,"versions":["2015-02-02"]},{"name":"AWS.ElasticBeanstalk","identifier":"elasticbeanstalk","browser":true,"versions":["2010-12-01"]},{"name":"AWS.ELB","identifier":"elb","browser":true,"versions":["2012-06-01"]},{"name":"AWS.ELBv2","identifier":"elbv2","browser":false,"versions":["2015-12-01"]},{"name":"AWS.EMR","identifier":"emr","browser":true,"versions":["2009-03-31"]},{"name":"AWS.ES","identifier":"es","browser":false,"versions":["2015-01-01"]},{"name":"AWS.ElasticTranscoder","identifier":"elastictranscoder","browser":true,"versions":["2012-09-25"]},{"name":"AWS.Firehose","identifier":"firehose","browser":true,"versions":["2015-08-04"]},{"name":"AWS.GameLift","identifier":"gamelift","browser":true,"versions":["2015-10-01"]},{"name":"AWS.Glacier","identifier":"glacier","browser":false,"versions":["2012-06-01"]},{"name":"AWS.Health","identifier":"health","browser":false,"versions":["2016-08-04"]},{"name":"AWS.IAM","identifier":"iam","browser":false,"versions":["2010-05-08"]},{"name":"AWS.ImportExport","identifier":"importexport","browser":false,"versions":["2010-06-01"]},{"name":"AWS.Inspector","identifier":"inspector","browser":true,"versions":["2016-02-16"]},{"name":"AWS.Iot","identifier":"iot","browser":true,"versions":["2015-05-28"]},{"name":"AWS.IotData","identifier":"iotdata","browser":true,"versions":["2015-05-28"]},{"name":"AWS.Kinesis","identifier":"kinesis","browser":true,"versions":["2013-12-02"]},{"name":"AWS.KinesisAnalytics","identifier":"kinesisanalytics","browser":false,"versions":["2015-08-14"]},{"name":"AWS.KMS","identifier":"kms","browser":true,"versions":["2014-11-01"]},{"name":"AWS.Lambda","identifier":"lambda","browser":true,"versions":["2014-11-11","2015-03-31"]},{"name":"AWS.LexRuntime","identifier":"lexruntime","browser":false,"versions":["2016-11-28"]},{"name":"AWS.Lightsail","identifier":"lightsail","browser":false,"versions":["2016-11-28"]},{"name":"AWS.MachineLearning","identifier":"machinelearning","browser":true,"versions":["2014-12-12"]},{"name":"AWS.MarketplaceCommerceAnalytics","identifier":"marketplacecommerceanalytics","browser":true,"versions":["2015-07-01"]},{"name":"AWS.MarketplaceMetering","identifier":"marketplacemetering","browser":false,"versions":["2016-01-14"]},{"name":"AWS.MTurk","identifier":"mturk","browser":false,"versions":["2017-01-17"]},{"name":"AWS.MobileAnalytics","identifier":"mobileanalytics","browser":true,"versions":["2014-06-05"]},{"name":"AWS.OpsWorks","identifier":"opsworks","browser":true,"versions":["2013-02-18"]},{"name":"AWS.OpsWorksCM","identifier":"opsworkscm","browser":false,"versions":["2016-11-01"]},{"name":"AWS.Organizations","identifier":"organizations","browser":false,"versions":["2016-11-28"]},{"name":"AWS.Pinpoint","identifier":"pinpoint","browser":false,"versions":["2016-12-01"]},{"name":"AWS.Polly","identifier":"polly","browser":true,"versions":["2016-06-10"]},{"name":"AWS.RDS","identifier":"rds","browser":true,"versions":["2013-01-10","2013-02-12","2013-09-09","2014-09-01","2014-10-31"]},{"name":"AWS.Redshift","identifier":"redshift","browser":true,"versions":["2012-12-01"]},{"name":"AWS.Rekognition","identifier":"rekognition","browser":true,"versions":["2016-06-27"]},{"name":"AWS.ResourceGroupsTaggingAPI","identifier":"resourcegroupstaggingapi","browser":false,"versions":["2017-01-26"]},{"name":"AWS.Route53","identifier":"route53","browser":true,"versions":["2013-04-01"]},{"name":"AWS.Route53Domains","identifier":"route53domains","browser":true,"versions":["2014-05-15"]},{"name":"AWS.S3","identifier":"s3","browser":true,"versions":["2006-03-01"]},{"name":"AWS.S3Control","identifier":"s3control","browser":false,"versions":["2018-08-20"]},{"name":"AWS.ServiceCatalog","identifier":"servicecatalog","browser":true,"versions":["2015-12-10"]},{"name":"AWS.SES","identifier":"ses","browser":true,"versions":["2010-12-01"]},{"name":"AWS.Shield","identifier":"shield","browser":false,"versions":["2016-06-02"]},{"name":"AWS.SimpleDB","identifier":"simpledb","browser":false,"versions":["2009-04-15"]},{"name":"AWS.SMS","identifier":"sms","browser":false,"versions":["2016-10-24"]},{"name":"AWS.Snowball","identifier":"snowball","browser":false,"versions":["2016-06-30"]},{"name":"AWS.SNS","identifier":"sns","browser":true,"versions":["2010-03-31"]},{"name":"AWS.SQS","identifier":"sqs","browser":true,"versions":["2012-11-05"]},{"name":"AWS.SSM","identifier":"ssm","browser":true,"versions":["2014-11-06"]},{"name":"AWS.StorageGateway","identifier":"storagegateway","browser":true,"versions":["2013-06-30"]},{"name":"AWS.StepFunctions","identifier":"stepfunctions","browser":false,"versions":["2016-11-23"]},{"name":"AWS.Support","identifier":"support","browser":false,"versions":["2013-04-15"]},{"name":"AWS.SWF","identifier":"swf","browser":false,"versions":["2012-01-25"]},{"name":"AWS.XRay","identifier":"xray","browser":false,"versions":["2016-04-12"]},{"name":"AWS.WAF","identifier":"waf","browser":true,"versions":["2015-08-24"]},{"name":"AWS.WAFRegional","identifier":"wafregional","browser":false,"versions":["2016-11-28"]},{"name":"AWS.WorkDocs","identifier":"workdocs","browser":false,"versions":["2016-05-01"]},{"name":"AWS.WorkSpaces","identifier":"workspaces","browser":false,"versions":["2015-04-08"]},{"name":"AWS.CodeStar","identifier":"codestar","browser":false,"versions":["2017-04-19"]},{"name":"AWS.LexModelBuildingService","identifier":"lexmodelbuildingservice","browser":false,"versions":["2017-04-19"]},{"name":"AWS.MarketplaceEntitlementService","identifier":"marketplaceentitlementservice","browser":false,"versions":["2017-01-11"]},{"name":"AWS.Athena","identifier":"athena","browser":false,"versions":["2017-05-18"]},{"name":"AWS.Greengrass","identifier":"greengrass","browser":false,"versions":["2017-06-07"]},{"name":"AWS.DAX","identifier":"dax","browser":false,"versions":["2017-04-19"]},{"name":"AWS.MigrationHub","identifier":"migrationhub","browser":false,"versions":["2017-05-31"]},{"name":"AWS.CloudHSMV2","identifier":"cloudhsmv2","browser":false,"versions":["2017-04-28"]},{"name":"AWS.Glue","identifier":"glue","browser":false,"versions":["2017-03-31"]},{"name":"AWS.Mobile","identifier":"mobile","browser":false,"versions":["2017-07-01"]},{"name":"AWS.Pricing","identifier":"pricing","browser":false,"versions":["2017-10-15"]},{"name":"AWS.CostExplorer","identifier":"costexplorer","browser":false,"versions":["2017-10-25"]},{"name":"AWS.MediaConvert","identifier":"mediaconvert","browser":false,"versions":["2017-08-29"]},{"name":"AWS.MediaLive","identifier":"medialive","browser":false,"versions":["2017-10-14"]},{"name":"AWS.MediaPackage","identifier":"mediapackage","browser":false,"versions":["2017-10-12"]},{"name":"AWS.MediaStore","identifier":"mediastore","browser":false,"versions":["2017-09-01"]},{"name":"AWS.MediaStoreData","identifier":"mediastoredata","browser":false,"versions":["2017-09-01"]},{"name":"AWS.AppSync","identifier":"appsync","browser":false,"versions":["2017-07-25"]},{"name":"AWS.GuardDuty","identifier":"guardduty","browser":false,"versions":["2017-11-28"]},{"name":"AWS.MQ","identifier":"mq","browser":false,"versions":["2017-11-27"]},{"name":"AWS.Comprehend","identifier":"comprehend","browser":false,"versions":["2017-11-27"]},{"name":"AWS.IoTJobsDataPlane","identifier":"iotjobsdataplane","browser":false,"versions":["2017-09-29"]},{"name":"AWS.KinesisVideoArchivedMedia","identifier":"kinesisvideoarchivedmedia","browser":false,"versions":["2017-09-30"]},{"name":"AWS.KinesisVideoMedia","identifier":"kinesisvideomedia","browser":false,"versions":["2017-09-30"]},{"name":"AWS.KinesisVideo","identifier":"kinesisvideo","browser":false,"versions":["2017-09-30"]},{"name":"AWS.SageMakerRuntime","identifier":"sagemakerruntime","browser":false,"versions":["2017-05-13"]},{"name":"AWS.SageMaker","identifier":"sagemaker","browser":false,"versions":["2017-07-24"]},{"name":"AWS.Translate","identifier":"translate","browser":false,"versions":["2017-07-01"]},{"name":"AWS.ResourceGroups","identifier":"resourcegroups","browser":false,"versions":["2017-11-27"]},{"name":"AWS.AlexaForBusiness","identifier":"alexaforbusiness","browser":false,"versions":["2017-11-09"]},{"name":"AWS.Cloud9","identifier":"cloud9","browser":false,"versions":["2017-09-23"]},{"name":"AWS.ServerlessApplicationRepository","identifier":"serverlessapplicationrepository","browser":false,"versions":["2017-09-08"]},{"name":"AWS.ServiceDiscovery","identifier":"servicediscovery","browser":false,"versions":["2017-03-14"]},{"name":"AWS.WorkMail","identifier":"workmail","browser":false,"versions":["2017-10-01"]},{"name":"AWS.AutoScalingPlans","identifier":"autoscalingplans","browser":false,"versions":["2018-01-06"]},{"name":"AWS.TranscribeService","identifier":"transcribeservice","browser":false,"versions":["2017-10-26"]},{"name":"AWS.Connect","identifier":"connect","browser":false,"versions":["2017-08-08"]},{"name":"AWS.ACMPCA","identifier":"acmpca","browser":false,"versions":["2017-08-22"]},{"name":"AWS.FMS","identifier":"fms","browser":false,"versions":["2018-01-01"]},{"name":"AWS.SecretsManager","identifier":"secretsmanager","browser":false,"versions":["2017-10-17"]},{"name":"AWS.IoTAnalytics","identifier":"iotanalytics","browser":false,"versions":["2017-11-27"]},{"name":"AWS.IoT1ClickDevicesService","identifier":"iot1clickdevicesservice","browser":false,"versions":["2018-05-14"]},{"name":"AWS.IoT1ClickProjects","identifier":"iot1clickprojects","browser":false,"versions":["2018-05-14"]},{"name":"AWS.PI","identifier":"pi","browser":false,"versions":["2018-02-27"]},{"name":"AWS.Neptune","identifier":"neptune","browser":false,"versions":["2014-10-31"]},{"name":"AWS.MediaTailor","identifier":"mediatailor","browser":false,"versions":["2018-04-23"]},{"name":"AWS.EKS","identifier":"eks","browser":false,"versions":["2017-11-01"]},{"name":"AWS.Macie","identifier":"macie","browser":false,"versions":["2017-12-19"]},{"name":"AWS.DLM","identifier":"dlm","browser":false,"versions":["2018-01-12"]},{"name":"AWS.Signer","identifier":"signer","browser":false,"versions":["2017-08-25"]},{"name":"AWS.Chime","identifier":"chime","browser":false,"versions":["2018-05-01"]},{"name":"AWS.PinpointEmail","identifier":"pinpointemail","browser":false,"versions":["2018-07-26"]},{"name":"AWS.RAM","identifier":"ram","browser":false,"versions":["2018-01-04"]},{"name":"AWS.Route53Resolver","identifier":"route53resolver","browser":false,"versions":["2018-04-01"]},{"name":"AWS.PinpointSMSVoice","identifier":"pinpointsmsvoice","browser":false,"versions":["2018-09-05"]},{"name":"AWS.QuickSight","identifier":"quicksight","browser":false,"versions":["2018-04-01"]},{"name":"AWS.RDSDataService","identifier":"rdsdataservice","browser":false,"versions":["2018-08-01"]},{"name":"AWS.Amplify","identifier":"amplify","browser":false,"versions":["2017-07-25"]},{"name":"AWS.DataSync","identifier":"datasync","browser":false,"versions":["2018-11-09"]},{"name":"AWS.RoboMaker","identifier":"robomaker","browser":false,"versions":["2018-06-29"]},{"name":"AWS.Transfer","identifier":"transfer","browser":false,"versions":["2018-11-05"]},{"name":"AWS.GlobalAccelerator","identifier":"globalaccelerator","browser":false,"versions":["2018-08-08"]},{"name":"AWS.ComprehendMedical","identifier":"comprehendmedical","browser":false,"versions":["2018-10-30"]},{"name":"AWS.KinesisAnalyticsV2","identifier":"kinesisanalyticsv2","browser":false,"versions":["2018-05-23"]},{"name":"AWS.MediaConnect","identifier":"mediaconnect","browser":false,"versions":["2018-11-14"]},{"name":"AWS.FSx","identifier":"fsx","browser":false,"versions":["2018-03-01"]},{"name":"AWS.SecurityHub","identifier":"securityhub","browser":false,"versions":["2018-10-26"]},{"name":"AWS.AppMesh","identifier":"appmesh","browser":false,"versions":["2018-10-01","2019-01-25"]},{"name":"AWS.LicenseManager","identifier":"licensemanager","browser":false,"versions":["2018-08-01"]},{"name":"AWS.Kafka","identifier":"kafka","browser":false,"versions":["2018-11-14"]},{"name":"AWS.ApiGatewayManagementApi","identifier":"apigatewaymanagementapi","browser":false,"versions":["2018-11-29"]},{"name":"AWS.ApiGatewayV2","identifier":"apigatewayv2","browser":false,"versions":["2018-11-29"]},{"name":"AWS.DocDB","identifier":"docdb","browser":false,"versions":["2014-10-31"]},{"name":"AWS.Backup","identifier":"backup","browser":false,"versions":["2018-11-15"]},{"name":"AWS.WorkLink","identifier":"worklink","browser":false,"versions":["2018-09-25"]},{"name":"AWS.Textract","identifier":"textract","browser":false,"versions":["2018-06-27"]},{"name":"AWS.ManagedBlockchain","identifier":"managedblockchain","browser":false,"versions":["2018-09-24"]},{"name":"AWS.MediaPackageVod","identifier":"mediapackagevod","browser":false,"versions":["2018-11-07"]},{"name":"AWS.GroundStation","identifier":"groundstation","browser":false,"versions":["2019-05-23"]},{"name":"AWS.IoTThingsGraph","identifier":"iotthingsgraph","browser":false,"versions":["2018-09-06"]},{"name":"AWS.IoTEvents","identifier":"iotevents","browser":false,"versions":["2018-07-27"]},{"name":"AWS.IoTEventsData","identifier":"ioteventsdata","browser":false,"versions":["2018-10-23"]},{"name":"AWS.Personalize","identifier":"personalize","browser":false,"versions":["2018-05-22"]},{"name":"AWS.PersonalizeEvents","identifier":"personalizeevents","browser":false,"versions":["2018-03-22"]},{"name":"AWS.PersonalizeRuntime","identifier":"personalizeruntime","browser":false,"versions":["2018-05-22"]},{"name":"AWS.ApplicationInsights","identifier":"applicationinsights","browser":false,"versions":["2018-11-25"]},{"name":"AWS.ServiceQuotas","identifier":"servicequotas","browser":false,"versions":["2019-06-24"]},{"name":"AWS.EC2InstanceConnect","identifier":"ec2instanceconnect","browser":false,"versions":["2018-04-02"]},{"name":"AWS.EventBridge","identifier":"eventbridge","browser":false,"versions":["2015-10-07"]},{"name":"AWS.LakeFormation","identifier":"lakeformation","browser":false,"versions":["2017-03-31"]},{"name":"AWS.ForecastService","identifier":"forecastservice","browser":false,"versions":["2018-06-26"]},{"name":"AWS.ForecastQueryService","identifier":"forecastqueryservice","browser":false,"versions":["2018-06-26"]},{"name":"AWS.QLDB","identifier":"qldb","browser":false,"versions":["2019-01-02"]},{"name":"AWS.QLDBSession","identifier":"qldbsession","browser":false,"versions":["2019-07-11"]},{"name":"AWS.WorkMailMessageFlow","identifier":"workmailmessageflow","browser":false,"versions":["2019-05-01"]},{"name":"AWS.CodeStarNotifications","identifier":"codestarnotifications","browser":false,"versions":["2019-10-15"]},{"name":"AWS.SavingsPlans","identifier":"savingsplans","browser":false,"versions":["2019-06-28"]},{"name":"AWS.SSO","identifier":"sso","browser":false,"versions":["2019-06-10"]},{"name":"AWS.SSOOIDC","identifier":"ssooidc","browser":false,"versions":["2019-06-10"]},{"name":"AWS.MarketplaceCatalog","identifier":"marketplacecatalog","browser":false,"versions":["2018-09-17"]},{"name":"AWS.DataExchange","identifier":"dataexchange","browser":false,"versions":["2017-07-25"]},{"name":"AWS.SESV2","identifier":"sesv2","browser":false,"versions":["2019-09-27"]},{"name":"AWS.MigrationHubConfig","identifier":"migrationhubconfig","browser":false,"versions":["2019-06-30"]},{"name":"AWS.ConnectParticipant","identifier":"connectparticipant","browser":false,"versions":["2018-09-07"]},{"name":"AWS.AppConfig","identifier":"appconfig","browser":false,"versions":["2019-10-09"]},{"name":"AWS.IoTSecureTunneling","identifier":"iotsecuretunneling","browser":false,"versions":["2018-10-05"]},{"name":"AWS.WAFV2","identifier":"wafv2","browser":false,"versions":["2019-07-29"]},{"name":"AWS.ElasticInference","identifier":"elasticinference","browser":false,"versions":["2017-07-25"]},{"name":"AWS.Imagebuilder","identifier":"imagebuilder","browser":false,"versions":["2019-12-02"]},{"name":"AWS.Schemas","identifier":"schemas","browser":false,"versions":["2019-12-02"]},{"name":"AWS.AccessAnalyzer","identifier":"accessanalyzer","browser":false,"versions":["2019-11-01"]},{"name":"AWS.CodeGuruReviewer","identifier":"codegurureviewer","browser":false,"versions":["2019-09-19"]},{"name":"AWS.CodeGuruProfiler","identifier":"codeguruprofiler","browser":false,"versions":["2019-07-18"]},{"name":"AWS.ComputeOptimizer","identifier":"computeoptimizer","browser":false,"versions":["2019-11-01"]},{"name":"AWS.FraudDetector","identifier":"frauddetector","browser":false,"versions":["2019-11-15"]},{"name":"AWS.Kendra","identifier":"kendra","browser":false,"versions":["2019-02-03"]},{"name":"AWS.NetworkManager","identifier":"networkmanager","browser":false,"versions":["2019-07-05"]},{"name":"AWS.Outposts","identifier":"outposts","browser":false,"versions":["2019-12-03"]},{"name":"AWS.AugmentedAIRuntime","identifier":"augmentedairuntime","browser":false,"versions":["2019-11-07"]},{"name":"AWS.EBS","identifier":"ebs","browser":false,"versions":["2019-11-02"]},{"name":"AWS.KinesisVideoSignalingChannels","identifier":"kinesisvideosignalingchannels","browser":false,"versions":["2019-12-04"]},{"name":"AWS.Detective","identifier":"detective","browser":false,"versions":["2018-10-26"]},{"name":"AWS.CodeStarconnections","identifier":"codestarconnections","browser":false,"versions":["2019-12-01"]},{"name":"AWS.Synthetics","identifier":"synthetics","browser":false,"versions":["2017-10-11"]},{"name":"AWS.IoTSiteWise","identifier":"iotsitewise","browser":false,"versions":["2019-12-02"]},{"name":"AWS.Macie2","identifier":"macie2","browser":false,"versions":["2020-01-01"]},{"name":"AWS.CodeArtifact","identifier":"codeartifact","browser":false,"versions":["2018-09-22"]},{"name":"AWS.Honeycode","identifier":"honeycode","browser":false,"versions":["2020-03-01"]},{"name":"AWS.IVS","identifier":"ivs","browser":false,"versions":["2020-07-14"]},{"name":"AWS.Braket","identifier":"braket","browser":false,"versions":["2019-09-01"]},{"name":"AWS.IdentityStore","identifier":"identitystore","browser":false,"versions":["2020-06-15"]},{"name":"AWS.Appflow","identifier":"appflow","browser":false,"versions":["2020-08-23"]},{"name":"AWS.RedshiftData","identifier":"redshiftdata","browser":false,"versions":["2019-12-20"]},{"name":"AWS.SSOAdmin","identifier":"ssoadmin","browser":false,"versions":["2020-07-20"]},{"name":"AWS.TimestreamQuery","identifier":"timestreamquery","browser":false,"versions":["2018-11-01"]},{"name":"AWS.TimestreamWrite","identifier":"timestreamwrite","browser":false,"versions":["2018-11-01"]},{"name":"AWS.S3Outposts","identifier":"s3outposts","browser":false,"versions":["2017-07-25"]},{"name":"AWS.DataBrew","identifier":"databrew","browser":false,"versions":["2017-07-25"]},{"name":"AWS.ServiceCatalogAppRegistry","identifier":"servicecatalogappregistry","browser":false,"versions":["2020-06-24"]},{"name":"AWS.NetworkFirewall","identifier":"networkfirewall","browser":false,"versions":["2020-11-12"]},{"name":"AWS.MWAA","identifier":"mwaa","browser":false,"versions":["2020-07-01"]},{"name":"AWS.AmplifyBackend","identifier":"amplifybackend","browser":false,"versions":["2020-08-11"]},{"name":"AWS.AppIntegrations","identifier":"appintegrations","browser":false,"versions":["2020-07-29"]},{"name":"AWS.ConnectContactLens","identifier":"connectcontactlens","browser":false,"versions":["2020-08-21"]},{"name":"AWS.DevOpsGuru","identifier":"devopsguru","browser":false,"versions":["2020-12-01"]},{"name":"AWS.ECRPUBLIC","identifier":"ecrpublic","browser":false,"versions":["2020-10-30"]},{"name":"AWS.LookoutVision","identifier":"lookoutvision","browser":false,"versions":["2020-11-20"]},{"name":"AWS.SageMakerFeatureStoreRuntime","identifier":"sagemakerfeaturestoreruntime","browser":false,"versions":["2020-07-01"]},{"name":"AWS.CustomerProfiles","identifier":"customerprofiles","browser":false,"versions":["2020-08-15"]},{"name":"AWS.AuditManager","identifier":"auditmanager","browser":false,"versions":["2017-07-25"]},{"name":"AWS.EMRcontainers","identifier":"emrcontainers","browser":false,"versions":["2020-10-01"]},{"name":"AWS.HealthLake","identifier":"healthlake","browser":false,"versions":["2017-07-01"]},{"name":"AWS.SagemakerEdge","identifier":"sagemakeredge","browser":false,"versions":["2020-09-23"]},{"name":"AWS.Amp","identifier":"amp","browser":false,"versions":["2020-08-01"]},{"name":"AWS.GreengrassV2","identifier":"greengrassv2","browser":false,"versions":["2020-11-30"]},{"name":"AWS.IotDeviceAdvisor","identifier":"iotdeviceadvisor","browser":false,"versions":["2020-09-18"]},{"name":"AWS.IoTFleetHub","identifier":"iotfleethub","browser":false,"versions":["2020-11-03"]},{"name":"AWS.IoTWireless","identifier":"iotwireless","browser":false,"versions":["2020-11-22"]},{"name":"AWS.Location","identifier":"location","browser":false,"versions":["2020-11-19"]},{"name":"AWS.WellArchitected","identifier":"wellarchitected","browser":false,"versions":["2020-03-31"]},{"name":"AWS.LexModelsV2","identifier":"lexmodelsv2","browser":false,"versions":["2020-08-07"]},{"name":"AWS.LexRuntimeV2","identifier":"lexruntimev2","browser":false,"versions":["2020-08-07"]}]}`);

        async function getDocsForCall(service, method) {
            var shortname = "";
            var version = "";

            sdkmetadata['services'].forEach(sdkmetadataservice => {
                if (sdkmetadataservice['name'].split(".")[1] == service) {
                    console.log(sdkmetadataservice);
                    shortname = sdkmetadataservice['identifier'];
                    version = sdkmetadataservice['versions'][sdkmetadataservice['versions'].length - 1];
                }
            });
            

            var ret = "";
            var sdkdatatxt = await fetch(`https://raw.githubusercontent.com/aws/aws-sdk-js/master/apis/${shortname}-${version}.min.json`);
            var sdkdata = await sdkdatatxt.json();

            if (sdkdata['operations'][method]) {
                if (sdkdata['operations'][method]['http'] && sdkdata['operations'][method]['http']['requestUri']) {
                    ret += `
    <i>httprequesturi</i>: <a href="#" class="dc" data-map="${sdkdata['operations'][method]['http']['requestUri']}">${sdkdata['operations'][method]['http']['requestUri']}</a>
                    `;
                }

                if (sdkdata['operations'][method]['input'] && sdkdata['operations'][method]['input']['members']) {
                    Object.keys(sdkdata['operations'][method]['input']['members']).forEach(member => {
                        ret += `
    <a href="#" class="dc" data-map="\$\{${member}\}">${member}</a>: ${JSON.stringify(sdkdata['operations'][method]['input']['members'][member])}
                    `;
                    });
                    
                }
            }

            return ret;
        }

        async function loadJson() {
            var mapdata = await fetch('https://raw.githubusercontent.com/iann0036/sdk-iam-map/main/map.json');
            map = await mapdata.json();
            updated_map = JSON.parse(JSON.stringify(map)); // copy
            var iamdefdata = await fetch('https://raw.githubusercontent.com/iann0036/sdk-iam-map/main/js/iam_definition.json');
            iamdef = await iamdefdata.json();

            document.getElementById('loadjsonarea').setAttribute('style', 'display: none;');

            nextMethod();
        }

        async function submitMapping() {
            var submitted_mapping = [];
            
            document.getElementById('methodmappingarea').querySelectorAll(".actionblock").forEach(actionblock => {
                var block = {
                    'action': actionblock.dataset.action,
                    'resource_mappings': {}
                };
                
                actionblock.querySelectorAll('.resourceblock').forEach(resourceblock => {
                    resourceblock.querySelectorAll('.mappinginput').forEach(mappinginput => {
                        block['resource_mappings'][mappinginput.dataset.varmatch] = {
                            "template": mappinginput.value
                        };
                    });
                });

                submitted_mapping.push(block);
            });

            updated_map['sdk_method_iam_mappings'][call] = submitted_mapping;

            document.getElementById('output').innerHTML = JSON.stringify(updated_map, null, 4);

            nextMethod();
        }

        function resolveService(service) {
            if (map['sdk_service_mappings'][service]) {
                return map['sdk_service_mappings'][service];
            }

            return service;
        }

        async function nextMethod() {
            var mappingkeys = Object.keys(map['sdk_method_iam_mappings']);

            call = mappingkeys.shift();

            var existingmappings = map['sdk_method_iam_mappings'][call];

            while (existingmappings[0]['resource_mappings'] || existingmappings[0]['undocumented'] || existingmappings[0]['conditions']) {
                call = mappingkeys.shift();
                existingmappings = map['sdk_method_iam_mappings'][call];
            }

            document.getElementById('methodmappingarea').innerHTML = `<h3>${call}</h3><br />`;

            var splitcall = call.split(".");
            document.getElementById('docs').innerHTML = await getDocsForCall(splitcall[0], splitcall[1]);

            existingmappings.forEach(existingmapping => {
                if (!existingmapping['resource_mappings']) {
                    var methodmap = document.createElement('div');
                    methodmap.setAttribute("class", "actionblock");
                    methodmap.setAttribute("data-action", existingmapping['action']);
                    methodmap.setAttribute("style", "border-width: 2px; border-style: solid; border-color: #dddddd;");

                    methodmap.innerHTML += `
                        <b>Action: </b><code>${existingmapping['action']}</code>
                    `;

                    var service = existingmapping['action'].split(":")[0];
                    var method = existingmapping['action'].split(":")[1];

                    iamdef.forEach(iamdefservice => {
                        if (iamdefservice['prefix'] == resolveService(service.toLowerCase())) {
                            iamdefservice['privileges'].forEach(priv => {
                                if (priv['privilege'].toLowerCase() == method.toLowerCase()) {
                                    priv['resource_types'].forEach(restype => {
                                        if (restype['resource_type'] != "") {
                                            var resourcemap = document.createElement('div');
                                            resourcemap.setAttribute("class", "resourceblock");
                                            resourcemap.setAttribute("data-restype", restype['resource_type']);
                                            resourcemap.setAttribute("style", "border-width: 2px; border-style: solid; border-color: #aaaadd;");

                                            resourcemap.innerHTML += `
                                                <br /><br /><b>Restype: </b><code>${restype['resource_type']}</code><br />
                                            `;

                                            iamdefservice['resources'].forEach(resource => {
                                                if (resource['resource'] == restype['resource_type'].replace("*", "")) {
                                                    resourcemap.innerHTML += `
                                                        <b>ARN style: </b><code>${resource['arn']}</code><br />
                                                    `;

                                                    var varmatches = [...resource['arn'].matchAll(/\$\{.+?\}/g)].map(x => {
                                                        var y = x.shift();
                                                        return y.substring(2, y.length-1);
                                                    });

                                                    varmatches.forEach(varmatch => {
                                                        if (!["Partition", "Region", "Account"].includes(varmatch)) {
                                                            resourcemap.innerHTML += `
                                                                <b><code>${varmatch}</code>: </b><input class="mappinginput" data-varmatch="${varmatch}" type="text" /><br />
                                                            `;
                                                        }
                                                    });
                                                }
                                            });

                                            methodmap.appendChild(resourcemap);
                                        }
                                    });
                                }
                            });
                        }
                    });

                    document.getElementById('methodmappingarea').appendChild(methodmap);
                }
            });

            document.querySelectorAll(".dc").forEach(dc => {
                dc.addEventListener('click', e => {
                    let mappinginputs = document.querySelectorAll(".mappinginput");
                    for (var mi of mappinginputs) {
                        if (mi.value == "") {
                            mi.value = e.srcElement.dataset.map;

                            break;
                        }
                    }
                });
            });

            delete map['sdk_method_iam_mappings'][call];
        }

        window.onload = async () => {
            document.getElementById('loadjsonbutton').click();
        }

        document.addEventListener("keypress", (e) => {
            if (e.key == '`') {
                document.getElementById('submitbutton').click();
            } else if (e.key == '\\') {
                document.getElementById('skipbutton').click();
            }
        }, false);
    </script>
  </body>
</html>